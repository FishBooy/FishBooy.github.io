---
title: ECMAScript5.1-(11)表达式
date: 2017-08-16 20:00:00
categories:
    - [技术, Javascript, ES5]
tags:
    - [Javascript]
---

## 11.2 Left-Hand-Side 表达式

### 11.2.2 new 操作符

表达式 new NewExpression 执行顺序如下：

1. 设 ref 为 NewExpression 的执行结果。
2. 设 constructor 为 GetValue(ref)。
3. 如果 constructor 的类型不是 Object，抛出 TypeError 异常。
4. 如果 constructor 没有实现内置方法[[Constructor]]，抛出 TypeError 异常。
5. 返回 constructor\[[Constructor]]()的执行结果。

表达式 new MemberExpression Arguments 的执行步骤如下：

1. 设 ref 为 NewExpression 的执行结果。
2. 设 constructor 为 GetValue(ref)。
3. 设 arglist 为 Arguments 的执行结果，即一个包含参数值的列表。
4. 如果 constructor 的类型不是 Object，抛出 TypeError 异常。
5. 如果 constructor 没有实现内置方法[[Constructor]]，抛出 TypeError 异常。
6. 返回 constructor\[[Constructor]](argList)的执行结果。

## 11.3 后缀表达式

### 11.3.1 后缀增量操作符

表达式 LeftHandSideExpression ++ 的执行步骤如下：

1. 设 lhs 为 LeftHandSideExpression 的执行结果。
2. 如果以下条件全部满足则抛出 SyntaxError 异常：
    - 如果 lhs 的值为布尔值 true
    - 如果 IsStrictReference(lhs)为 true
    - 如果 lhs 是规范中定义的 Environment Record 类型
    - GetReferenceName(lhs)是“eval”或“arguments”
3. 设 oldValue 为 ToNumber(GetValue(lhs))。
4. 设 newValue 为 oldValue+1。
5. 执行 PutValue(lhs, newValue)。
6. 返回 oldValue。

### 11.3.2 后缀减量操作符

表达式 LeftHandSideExpression -- 的执行步骤如下：

1. 设 lhs 为 LeftHandSideExpression 的执行结果。
2. 如果以下条件全部满足则抛出 SyntaxError 异常：
    - 如果 lhs 的值为布尔值 true
    - 如果 IsStrictReference(lhs)为 true
    - 如果 lhs 是规范中定义的 Environment Record 类型
    - GetReferenceName(lhs)是“eval”或“arguments”
3. 设 oldValue 为 ToNumber(GetValue(lhs))。
4. 设 newValue 为 oldValue-1。
5. 执行 PutValue(lhs, newValue)。
6. 返回 oldValue。

## 11.4 一元操作符

### 11.4.3 typeof 操作符

表达式 typeof UnaryExpression 执行步骤如下：

1. 设 val 为 UnaryExpression 的执行结果。
2. 如果 Type(val)是 Reference，那么：
    - a. 如果 UnresolvableReference(val)为 true，返回“undefined”。
    - b. 设置 val 为 GetValue(val)。
3. 返回一个按下表定义的 Type(val)的字符串。

| Type of val | Result |
| --- | --- |
| Undefined | "undefined" |
| Null | "object" |
| Boolean | "boolean" |
| Number | "number" |
| String | "string" |
| Object(原生对象且没有实现内置方法[[Call]]) | "object" |
| Object(原生对象且实现了内置方法[[Call]]) | "function" |
| Object(非原生对象且没有实现内置方法[[Call]]) | Implementation-defined except may not be "undefined", "boolean", "number", or "string" |

### 11.4.4 前缀增量操作符

表达式 ++ UnaryExpression 执行步骤如下：

1. 设 expr 为 UnaryExpression 的执行结果。
2. 如果以下条件全部满足则抛出 SyntaxError 异常：
    - 如果 expr 的值为布尔值 true
    - 如果 IsStrictReference(expr)为 true
    - 如果 expr 是规范中定义的 Environment Record 类型
    - GetReferenceName(expr)是“eval”或“arguments”
3. 设 oldValue 为 ToNumber(GetValue(expr))。
4. 设 newValue 为 oldValue+1。
5. 执行 PutValue(expr, newValue)。
6. 返回 newValue。

### 11.4.5 前缀减量操作符

表达式 -- UnaryExpression 执行步骤如下：

1. 设 expr 为 UnaryExpression 的执行结果。
2. 如果以下条件全部满足则抛出 SyntaxError 异常：
    - 如果 expr 的值为布尔值 true
    - 如果 IsStrictReference(expr)为 true
    - 如果 expr 是规范中定义的 Environment Record 类型
    - GetReferenceName(expr)是“eval”或“arguments”
3. 设 oldValue 为 ToNumber(GetValue(expr))。
4. 设 newValue 为 oldValue-1。
5. 执行 PutValue(expr, newValue)。
6. 返回 newValue。

### 11.4.6 一元+操作符

一元+操作符将操作数转化为 Number 类型的值。表达式 + UnaryExpression 的执行步骤如下：

1. 设 expr 为 UnaryExpression 的执行结果。
2. 返回 ToNumber（GetValue(expr)）的执行结果。

### 11.4.7 一元-操作符

一元+操作符将操作数转化为 Number 类型的值，然后将值取负。注：+0 的操作结果为-0，-0 的操作结果为+0。表达式 - UnaryExpression 的执行步骤如下：

1. 设 expr 为 UnaryExpression 的执行结果。
2. 设 oldValue 为 ToNumber（GetValue(expr)）的执行结果。
3. 如果 oldValue 为 NaN，返回 NaN。
4. 返回 oldValue 的负数值。

### 11.4.9 逻辑非操作符(!)

表达式 ! UnaryExpression 的执行步骤如下：

1. 设 expr 为 UnaryExpression 的执行结果。
2. 设 oldValue 为 ToBoolean(GetValue(expr))的执行结果。
3. 如果 oldValue 为 true 则返回 false。
4. 返回 true。

## 11.6 添加操作符

### 11.6.1 加法操作符(+)

加法操作符的作用是将两个字符串连接或者进行数学加运算。表达式 AdditiveExpression + MultiplicativeExpression 的执行步骤如下：

1. 设 lref 为 AdditiveExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 MultiplicativeExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 设 lprim 为 ToPrimitive(lval)。
6. 设 rprim 为 ToPrimitive(rval)。
7. 如果 lprim 和 rprim 的值都是 String 类型，那么返回一个由两者连接组成的字符串。
8. 返回 ToNumber(lprim)+ToNumber(rprim)的运算值。

### 11.6.2 加法操作符(-)

表达式 AdditiveExpression - MultiplicativeExpression 的执行步骤如下：

1. 设 lref 为 AdditiveExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 MultiplicativeExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 设 lprim 为 ToNumber(lval)。
6. 设 rprim 为 ToNumber(rval)。
7. 返回 ToNumber(lprim)-ToNumber(rprim)的运算值。

## 11.8 关系操作符

### 11.8.1 小于操作符(<)

表达式 RelationalExpression < ShiftExpression 的执行步骤如下：

1. 设 lref 为 RelationalExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 ShiftExpression 的执行结果。
4. 设 rval 为 ShiftExpressionGetValue(rref)。
5. 设 r 为 lval < rval 的返回结果(见 11.8.5)。
6. 如果 r 是 undefined 则返回 false，否则返回 r。

### 11.8.2 大于操作符(>)

表达式 RelationalExpression > ShiftExpression 的执行步骤如下：

1. 设 lref 为 RelationalExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 ShiftExpression 的执行结果。
4. 设 rval 为 ShiftExpressionGetValue(rref)。
5. 设 r 为 rval < lval 的返回结果, LeftFirst 设置为 false。(见 11.8.5)。
6. 如果 r 是 undefined 则返回 false，否则返回 r。

### 11.8.3 小于等于操作符(<=)

1-5 步骤等同于 > 操作符。 6.如果 r 是 undefined 或 true，返回 false。否则返回 true。

### 11.8.4 大于等于操作符(>=)

1-5 步骤等同于 < 操作符。 6.如果 r 是 undefined 或 true，返回 false。否则返回 true。

### 11.8.5 关系比较操作

表达式 x < y 执行步骤如下：

1. 如果 LeftFlag 为 true，那么
    - a. 设 px 为 ToPrimitive(x, hint Number)的返回值。
    - b. 设 py 为 ToPrimitive(y, hint Number)的返回值。
2. 如果 LeftFlag 为 false，那么
    - a. 设 py 为 ToPrimitive(y, hint Number)的返回值。
    - b. 设 px 为 ToPrimitive(x, hint Number)的返回值。
3. 只要不满足“Type(px),Type(py)都是 String 类型”，那么：
    - a. 把 ToNumber(px)的结果赋值给 nx
    - b. 把 ToNumber(py)的结果赋值给 ny
    - c. 如果 nx，ny 中有一个值为 NaN，那么返回 undefined；
    - d. 如果 nx，ny 是+0，-0 的比较那么返回 false；
    - e. 如果 nx 是正无穷+∞，返回 false；
    - f. 如果 ny 是正无穷+∞，返回 true；
    - g. 如果 nx 是负无穷-∞，返回 true；
    - h. 如果 ny 是负无穷-∞，返回 false；
    - i. 如果 nx 在数值上比 ny 小则返回 true，如果 nx 和 ny 相等则返回 false。
4. 如果 px，py 都是 String 类型，那么：
    - a. 如果 px 是 py 的前缀（如果字符串 b 能由字符串 a 和其他字符串拼接而成，那么 a 就是 b 的前缀，如：“he”是“hello”的前缀），则返回 true，如果 y 是 x 的前缀则返回 false；
    - b. 以 k 作为索引值从 0 开始递增，依次比较 px 和 py 在 k 处的字符，如果两个字符相同则继续比较，如果不同则停止比较并把 px[k]赋值给 m，把 py[k]赋值给 n；
    - c. 把 m，n 在 ASC II 字符码集合中对应的索引数值分别赋值给 l、r，返回 l < r（都是 Number 类型）的比较结果。

### 11.8.6 instanceof 操作符

表达式 RelationalExpression instanceof ShiftExpression 的执行步骤如下：

1. 设 lref 为 RelationalExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 ShiftExpression 的执行结果。
4. 设 rval 为 ShiftExpressionGetValue(rref)。
5. 如果 Type(rval)不是 Object，则抛出 TypeError 的异常。
6. 如果 rval 没有内置方法[[HasInstance]]，则抛出 TypeError 的异常。
7. 返回 rval\[[HasInstance]](lval)的返回值。

### 11.8.7 in 操作符

1. 设 lref 为 RelationalExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 ShiftExpression 的执行结果。
4. 设 rval 为 ShiftExpressionGetValue(rref)。
5. 如果 Type(rval)不是 Object，则抛出 TypeError 的异常。
6. 返回 rval\[[HasProperty]](lval)的返回值。

## 11.9 相等操作符

### 11.9.1 等于操作符(==)

表达式 EqualityExpression == RelationalExpression 的执行步骤如下：

1. 设 lref 为 EqualityExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 RelationalExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 返回 rval == lval 的返回值（见 11.9.3）

### 11.9.2 不等操作符(!=)

表达式 EqualityExpression != RelationalExpression 的执行步骤如下：

1. 设 lref 为 EqualityExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 RelationalExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 设 r 为 rval == lval 的返回值（见 11.9.3）
6. 如果 r 是 true，则返回 false。否则返回 true。

### 11.9.3 相等比较操作

比较式 x == y，最终返回 true 或 false。执行步骤如下：

1. 如果 Type(x)和 Type(y)一致，那么 a.如果 Type(x)是 Undefined，则返回 true。 b.如果 Type(x)是 Null，则返回 true。 c.如果 Type(x)是 Number，那么 - i. 如果 x 是 NaN，返回 false。 - ii. 如果 y 是 NaN，返回 false。 - iii. 如果 x，y 的值相同则返回 true。 - iv. 如果 x 是+0，y 是-0，返回 true。 - v. 如果 x 是-0，y 是+0，返回 true。 - vi. 其他返回 false。 d. 如果 Type(x)是 String，那么当 x，y 为相同字符串时返回 true，否则返回 false。 e. 如果 Type(x)是 Boolean，那么 x，y 都为 true/false 时返回 true。否则返回 false。 f. 如果 x，y 指向同一个对象，则返回 true，否则返回 false。
2. 如果 x 是 null，y 是 undefined，返回 true。
3. 如果 x 是 undefined，y 是 null，返回 true。
4. 如果 Type(x)是 Number，Type(y)是 String，那么返回 x == ToNumber(y) 的结果。
5. 如果 Type(x)是 String，Type(y)是 Number，那么返回 ToNumber(x) == y 的结果。
6. 如果 Type(x)是 Boolean，那么返回 ToNumber(x) == y 的结果。
7. 如果 Type(y)是 Boolean，那么返回 x == ToNumber(y) 的结果。
8. 如果 Type(x)是 String 或 Number，Type(y)是 Object，返回 x == ToPrimitive(y) 的结果。
9. 如果 Type(x)是 Object，Type(y)String 或 Number ToPrimitive(x) == y 的结果。
10. 返回 false。

### 11.9.4 严格等于操作符(===)

表达式 EqualityExpression === RelationalExpression 的执行步骤如下：

1. 设 lref 为 EqualityExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 RelationalExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 返回 rval === lval 的返回值（见 11.9.6）

### 11.9.4 严格不等操作符(!==)

表达式 EqualityExpression !== RelationalExpression 的执行步骤如下：

1. 设 lref 为 EqualityExpression 的执行结果。
2. 设 lval 为 GetValue(lref)。
3. 设 rref 为 RelationalExpression 的执行结果。
4. 设 rval 为 GetValue(rref)。
5. 设 r 为 rval === lval 的返回值（见 11.9.6）
6. 如果 r 是 true 则返回 false，反之返回 true。

### 11.9.6 严格相等操作

比较式 x === y 的操作结果为 true 或 false，操作步骤如下：

1. 如果 Type(x)和 Type(y)不同，直接返回 false。
2. 如果 Type(x)是 Undefined，返回 true。
3. 如果 Type(x)是 Null，返回 true。
4. 如果 Type(x)是 NuNumber，那么 c.如果 Type(x)是 Number，那么 - i. 如果 x 是 NaN，返回 false。 - ii. 如果 y 是 NaN，返回 false。 - iii. 如果 x，y 的值相同则返回 true。 - iv. 如果 x 是+0，y 是-0，返回 true。 - v. 如果 x 是-0，y 是+0，返回 true。 - vi. 其他返回 false。
5. 如果 Type(x)是 String，x，y 为相同的字符串则返回 true，否则返回 false。
6. 如果 Type(x)是 Boolean，那么 x，y 都为 true/false 时返回 true。否则返回 false。
7. 如果 x，y 指向同一个对象，则返回 true，否则返回 false。
