---
title: ECMAScript5.1-(11)表达式
date: 2017-08-16 20:00:00
categories:
- [技术,Javascript,ES5]
tags:
- [Javascript]
---

## 11.2 Left-Hand-Side 表达式

### 11.2.2 new 操作符

表达式 new NewExpression 执行顺序如下：

1. 设ref为NewExpression的执行结果。
2. 设constructor为 GetValue(ref)。
3. 如果constructor的类型不是Object，抛出TypeError异常。
4. 如果constructor没有实现内置方法[[Constructor]]，抛出TypeError异常。
5. 返回constructor\[[Constructor]]()的执行结果。

表达式 new MemberExpression Arguments 的执行步骤如下：

1. 设ref为NewExpression的执行结果。
2. 设constructor为 GetValue(ref)。
3. 设arglist为Arguments的执行结果，即一个包含参数值的列表。
4. 如果constructor的类型不是Object，抛出TypeError异常。
5. 如果constructor没有实现内置方法[[Constructor]]，抛出TypeError异常。
6. 返回constructor\[[Constructor]](argList)的执行结果。

## 11.3 后缀表达式

### 11.3.1 后缀增量操作符

表达式 LeftHandSideExpression ++ 的执行步骤如下：

1. 设lhs为LeftHandSideExpression的执行结果。
2. 如果以下条件全部满足则抛出SyntaxError异常：
    - 如果lhs的值为布尔值true
    - 如果IsStrictReference(lhs)为true
    - 如果lhs是规范中定义的Environment Record类型
    - GetReferenceName(lhs)是“eval”或“arguments”
3. 设oldValue为ToNumber(GetValue(lhs))。
4. 设newValue为oldValue+1。
5. 执行PutValue(lhs, newValue)。
6. 返回oldValue。

### 11.3.2 后缀减量操作符

表达式 LeftHandSideExpression -- 的执行步骤如下：

1. 设lhs为LeftHandSideExpression的执行结果。
2. 如果以下条件全部满足则抛出SyntaxError异常：
    - 如果lhs的值为布尔值true
    - 如果IsStrictReference(lhs)为true
    - 如果lhs是规范中定义的Environment Record类型
    - GetReferenceName(lhs)是“eval”或“arguments”
3. 设oldValue为ToNumber(GetValue(lhs))。
4. 设newValue为oldValue-1。
5. 执行PutValue(lhs, newValue)。
6. 返回oldValue。

## 11.4 一元操作符

### 11.4.3 typeof 操作符

表达式 typeof UnaryExpression 执行步骤如下：

1. 设val为UnaryExpression的执行结果。
2. 如果Type(val)是Reference，那么：
    - a. 如果UnresolvableReference(val)为true，返回“undefined”。
    - b. 设置val为GetValue(val)。
3. 返回一个按下表定义的Type(val)的字符串。

Type of val|Result
-|-
Undefined|"undefined"
Null|"object"
Boolean|"boolean"
Number|"number"
String|"string"
Object(原生对象且没有实现内置方法[[Call]])|"object"
Object(原生对象且实现了内置方法[[Call]])|"function"
Object(非原生对象且没有实现内置方法[[Call]])|Implementation-defined except may not be "undefined", "boolean", "number", or "string"

### 11.4.4 前缀增量操作符

表达式 ++ UnaryExpression 执行步骤如下：

1. 设expr为UnaryExpression的执行结果。
2. 如果以下条件全部满足则抛出SyntaxError异常：
    - 如果expr的值为布尔值true
    - 如果IsStrictReference(expr)为true
    - 如果expr是规范中定义的Environment Record类型
    - GetReferenceName(expr)是“eval”或“arguments”
3. 设oldValue为ToNumber(GetValue(expr))。
4. 设newValue为oldValue+1。
5. 执行PutValue(expr, newValue)。
6. 返回newValue。

### 11.4.5 前缀减量操作符

表达式 -- UnaryExpression 执行步骤如下：

1. 设expr为UnaryExpression的执行结果。
2. 如果以下条件全部满足则抛出SyntaxError异常：
    - 如果expr的值为布尔值true
    - 如果IsStrictReference(expr)为true
    - 如果expr是规范中定义的Environment Record类型
    - GetReferenceName(expr)是“eval”或“arguments”
3. 设oldValue为ToNumber(GetValue(expr))。
4. 设newValue为oldValue-1。
5. 执行PutValue(expr, newValue)。
6. 返回newValue。

### 11.4.6 一元+操作符

一元+操作符将操作数转化为Number类型的值。表达式 + UnaryExpression 的执行步骤如下：

1. 设expr为UnaryExpression的执行结果。
2. 返回ToNumber（GetValue(expr)）的执行结果。

### 11.4.7 一元-操作符

一元+操作符将操作数转化为Number类型的值，然后将值取负。注：+0的操作结果为-0，-0的操作结果为+0。表达式 - UnaryExpression 的执行步骤如下：

1. 设expr为UnaryExpression的执行结果。
2. 设oldValue为ToNumber（GetValue(expr)）的执行结果。
3. 如果oldValue为NaN，返回NaN。
4. 返回oldValue的负数值。

### 11.4.9 逻辑非操作符(!)

表达式 ! UnaryExpression 的执行步骤如下：

1. 设expr为UnaryExpression的执行结果。
2. 设oldValue为ToBoolean(GetValue(expr))的执行结果。
3. 如果oldValue为true则返回false。
4. 返回true。

## 11.6 添加操作符

### 11.6.1 加法操作符(+)

加法操作符的作用是将两个字符串连接或者进行数学加运算。表达式 AdditiveExpression + MultiplicativeExpression 的执行步骤如下：

1. 设lref为AdditiveExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为MultiplicativeExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 设lprim为ToPrimitive(lval)。
6. 设rprim为ToPrimitive(rval)。
7. 如果lprim和rprim的值都是String类型，那么返回一个由两者连接组成的字符串。
8. 返回ToNumber(lprim)+ToNumber(rprim)的运算值。

### 11.6.2 加法操作符(-)

表达式 AdditiveExpression - MultiplicativeExpression 的执行步骤如下：

1. 设lref为AdditiveExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为MultiplicativeExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 设lprim为ToNumber(lval)。
6. 设rprim为ToNumber(rval)。
7. 返回ToNumber(lprim)-ToNumber(rprim)的运算值。

## 11.8 关系操作符

### 11.8.1 小于操作符(<)

表达式 RelationalExpression < ShiftExpression 的执行步骤如下：

1. 设lref为RelationalExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为ShiftExpression的执行结果。
4. 设rval为ShiftExpressionGetValue(rref)。
5. 设r为lval < rval 的返回结果(见11.8.5)。
6. 如果r是undefined 则返回false，否则返回r。

### 11.8.2 大于操作符(>)

表达式 RelationalExpression > ShiftExpression 的执行步骤如下：

1. 设lref为RelationalExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为ShiftExpression的执行结果。
4. 设rval为ShiftExpressionGetValue(rref)。
5. 设r为rval < lval 的返回结果, LeftFirst设置为false。(见11.8.5)。
6. 如果r是undefined 则返回false，否则返回r。

### 11.8.3 小于等于操作符(<=)

1-5步骤等同于 > 操作符。
6.如果r是undefined或true，返回false。否则返回true。

### 11.8.4 大于等于操作符(>=)

1-5步骤等同于 < 操作符。
6.如果r是undefined或true，返回false。否则返回true。

### 11.8.5 关系比较操作

表达式 x < y 执行步骤如下：

1. 如果LeftFlag为true，那么
    - a. 设px为ToPrimitive(x, hint Number)的返回值。
    - b. 设py为ToPrimitive(y, hint Number)的返回值。
2. 如果LeftFlag为false，那么
    - a. 设py为ToPrimitive(y, hint Number)的返回值。
    - b. 设px为ToPrimitive(x, hint Number)的返回值。
3. 只要不满足“Type(px),Type(py)都是String类型”，那么：
    - a. 把ToNumber(px)的结果赋值给nx
    - b. 把ToNumber(py)的结果赋值给ny
    - c. 如果nx，ny中有一个值为NaN，那么返回undefined；
    - d. 如果nx，ny是+0，-0的比较那么返回false；
    - e. 如果nx是正无穷+∞，返回false；
    - f. 如果ny是正无穷+∞，返回true；
    - g. 如果nx是负无穷-∞，返回true；
    - h. 如果ny是负无穷-∞，返回false；
    - i. 如果nx在数值上比ny小则返回true，如果nx和ny相等则返回false。
4. 如果px，py都是String类型，那么：
    - a. 如果px是py的前缀（如果字符串b能由字符串a和其他字符串拼接而成，那么a就是b的前缀，如：“he”是“hello”的前缀），则返回true，如果y是x的前缀则返回false；
    - b. 以k作为索引值从0开始递增，依次比较px和py在k处的字符，如果两个字符相同则继续比较，如果不同则停止比较并把px[k]赋值给m，把py[k]赋值给n；
    - c. 把m，n在ASC II字符码集合中对应的索引数值分别赋值给l、r，返回 l < r（都是Number类型）的比较结果。

### 11.8.6 instanceof 操作符

表达式 RelationalExpression instanceof ShiftExpression 的执行步骤如下：

1. 设lref为RelationalExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为ShiftExpression的执行结果。
4. 设rval为ShiftExpressionGetValue(rref)。
5. 如果Type(rval)不是Object，则抛出TypeError的异常。
6. 如果rval没有内置方法[[HasInstance]]，则抛出TypeError的异常。
7. 返回rval\[[HasInstance]](lval)的返回值。

### 11.8.7 in 操作符

1. 设lref为RelationalExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为ShiftExpression的执行结果。
4. 设rval为ShiftExpressionGetValue(rref)。
5. 如果Type(rval)不是Object，则抛出TypeError的异常。
6. 返回rval\[[HasProperty]](lval)的返回值。

## 11.9 相等操作符

### 11.9.1 等于操作符(==)

表达式 EqualityExpression == RelationalExpression 的执行步骤如下：

1. 设lref为EqualityExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为RelationalExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 返回 rval == lval 的返回值（见11.9.3）

### 11.9.2 不等操作符(!=)

表达式 EqualityExpression != RelationalExpression 的执行步骤如下：

1. 设lref为EqualityExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为RelationalExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 设r为 rval == lval 的返回值（见11.9.3）
6. 如果r是true，则返回false。否则返回true。

### 11.9.3 相等比较操作

比较式 x == y，最终返回true或false。执行步骤如下：

1. 如果Type(x)和Type(y)一致，那么
    a.如果Type(x)是Undefined，则返回true。
    b.如果Type(x)是Null，则返回true。
    c.如果Type(x)是Number，那么
        - i. 如果x是NaN，返回false。
        - ii. 如果y是NaN，返回false。
        - iii. 如果x，y的值相同则返回true。
        - iv. 如果x是+0，y是-0，返回true。
        - v. 如果x是-0，y是+0，返回true。
        - vi. 其他返回false。
    d. 如果Type(x)是String，那么当x，y为相同字符串时返回true，否则返回false。
    e. 如果Type(x)是Boolean，那么x，y都为true/false时返回true。否则返回false。
    f. 如果x，y指向同一个对象，则返回true，否则返回false。
2. 如果x是null，y是undefined，返回true。
3. 如果x是undefined，y是null，返回true。
4. 如果Type(x)是Number，Type(y)是String，那么返回 x == ToNumber(y) 的结果。
5. 如果Type(x)是String，Type(y)是Number，那么返回 ToNumber(x) == y 的结果。
6. 如果Type(x)是Boolean，那么返回 ToNumber(x) == y 的结果。
7. 如果Type(y)是Boolean，那么返回 x == ToNumber(y) 的结果。
8. 如果Type(x)是String或Number，Type(y)是Object，返回 x == ToPrimitive(y) 的结果。
9. 如果Type(x)是Object，Type(y)String或Number ToPrimitive(x) == y 的结果。
10. 返回false。

### 11.9.4 严格等于操作符(===)

表达式 EqualityExpression === RelationalExpression 的执行步骤如下：

1. 设lref为EqualityExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为RelationalExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 返回 rval === lval 的返回值（见11.9.6）

### 11.9.4 严格不等操作符(!==)

表达式 EqualityExpression !== RelationalExpression 的执行步骤如下：

1. 设lref为EqualityExpression的执行结果。
2. 设lval为GetValue(lref)。
3. 设rref为RelationalExpression的执行结果。
4. 设rval为GetValue(rref)。
5. 设r为 rval === lval 的返回值（见11.9.6）
6. 如果r是true则返回false，反之返回true。

### 11.9.6 严格相等操作

比较式 x === y 的操作结果为true或false，操作步骤如下：

1. 如果Type(x)和Type(y)不同，直接返回false。
2. 如果Type(x)是Undefined，返回true。
3. 如果Type(x)是Null，返回true。
4. 如果Type(x)是NuNumber，那么
    c.如果Type(x)是Number，那么
        - i. 如果x是NaN，返回false。
        - ii. 如果y是NaN，返回false。
        - iii. 如果x，y的值相同则返回true。
        - iv. 如果x是+0，y是-0，返回true。
        - v. 如果x是-0，y是+0，返回true。
        - vi. 其他返回false。
5. 如果Type(x)是String，x，y为相同的字符串则返回true，否则返回false。
6. 如果Type(x)是Boolean，那么x，y都为true/false时返回true。否则返回false。
7. 如果x，y指向同一个对象，则返回true，否则返回false。
