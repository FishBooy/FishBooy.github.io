<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>ES8ä¸­çš„asyncå‡½æ•°[è¯‘] | Calvin&#39;s notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Promise è®©å¼€å‘è€…èƒ½å¤Ÿä»¥æŒ‰é¡ºåºæ‰§è¡Œçš„ä¹¦å†™æ–¹å¼æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚æ­¥æ“ä½œã€‚è€Œ ES8 ä¸­æ–°å¢çš„ async å‡½æ•°åˆ™èƒ½å¤Ÿè®©å¼€å‘è€…ä»¥å®Œå…¨åŒæ­¥çš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œã€‚è™½ç„¶ä½¿ç”¨ Promise å’Œ generator å‡½æ•°ä¹Ÿèƒ½å¤Ÿå®ç°å’Œ async å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ async å‡½æ•°å°è£…äº†è®¸å¤šå†…éƒ¨æ“ä½œï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä»¥æ›´å°‘çš„ä»£ç å»å¤„ç†å¼‚æ­¥æ“ä½œã€‚ ä»£ç ç¤ºä¾‹åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªè¿”å› promise">
<meta property="og:type" content="article">
<meta property="og:title" content="ES8ä¸­çš„asyncå‡½æ•°[è¯‘]">
<meta property="og:url" content="http://www.qiwenke.com/2019/03/16/ES8%E4%B8%AD%E7%9A%84Async-Await%E5%87%BD%E6%95%B0/index.html">
<meta property="og:site_name" content="Calvin&#39;s notes">
<meta property="og:description" content="Promise è®©å¼€å‘è€…èƒ½å¤Ÿä»¥æŒ‰é¡ºåºæ‰§è¡Œçš„ä¹¦å†™æ–¹å¼æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚æ­¥æ“ä½œã€‚è€Œ ES8 ä¸­æ–°å¢çš„ async å‡½æ•°åˆ™èƒ½å¤Ÿè®©å¼€å‘è€…ä»¥å®Œå…¨åŒæ­¥çš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œã€‚è™½ç„¶ä½¿ç”¨ Promise å’Œ generator å‡½æ•°ä¹Ÿèƒ½å¤Ÿå®ç°å’Œ async å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ async å‡½æ•°å°è£…äº†è®¸å¤šå†…éƒ¨æ“ä½œï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä»¥æ›´å°‘çš„ä»£ç å»å¤„ç†å¼‚æ­¥æ“ä½œã€‚ ä»£ç ç¤ºä¾‹åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªè¿”å› promise">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-03-16T21:28:56.000Z">
<meta property="article:modified_time" content="2020-06-07T18:13:37.136Z">
<meta property="article:author" content="Calvin">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Calvin&#39;s notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  

  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/prism.css">

    
<link rel="stylesheet" href="/css/prism_custom.css">

  
<meta name="generator" content="Hexo 4.2.0"></head>

<body><div class="site-column-post">
  <div class="site-content-post">
      <article class="post-all-content">
          <div class="post-name">
            <h2>ES8ä¸­çš„asyncå‡½æ•°[è¯‘]</h2>
          </div>
          <div class="post-info">
              <span class="post-info-date">
                <i class="iconfont icon-calendar"></i>
                2019-03-16
              </span>
              <span class="post-update">
                <i class="iconfont icon-copy"></i>
                2020-06-07
              </span>
              
              
              <span class="back-to-home">
                <a href="/">
                  <span>Calvin&#39;s notes</span>
                  <i class="iconfont icon-home"></i>
                </a>
              </span>
          </div>
          <div class="post-body">
            <p>Promise è®©å¼€å‘è€…èƒ½å¤Ÿä»¥æŒ‰é¡ºåºæ‰§è¡Œçš„ä¹¦å†™æ–¹å¼æ›´æ–¹ä¾¿çš„å¤„ç†å¼‚æ­¥æ“ä½œã€‚è€Œ ES8 ä¸­æ–°å¢çš„ async å‡½æ•°åˆ™èƒ½å¤Ÿè®©å¼€å‘è€…ä»¥å®Œå…¨åŒæ­¥çš„æ–¹å¼å¤„ç†å¼‚æ­¥æ“ä½œã€‚è™½ç„¶ä½¿ç”¨ Promise å’Œ generator å‡½æ•°ä¹Ÿèƒ½å¤Ÿå®ç°å’Œ async å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†æ˜¯ async å‡½æ•°å°è£…äº†è®¸å¤šå†…éƒ¨æ“ä½œï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿä»¥æ›´å°‘çš„ä»£ç å»å¤„ç†å¼‚æ­¥æ“ä½œã€‚</p>
<h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå£°æ˜äº†ä¸€ä¸ªè¿”å› promise çš„å‡½æ•°ï¼Œè¯¥ promise ä¼šåœ¨ 2s åä»¥ ğŸ¤¡ è½¬åˆ° resolved çŠ¶æ€ã€‚ç„¶åæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª async å‡½æ•°ï¼Œå¹¶ä¸”åœ¨å‡½æ•°å†…ä½¿ç”¨ await ç­‰å¾… promise ç›´åˆ° resolvedï¼Œä¸€æ—¦ resolved åˆ™ç«‹åˆ»æ‰“å° resolved value ä¹Ÿå°±æ˜¯ msgã€‚</p>
<pre><code class="javascript">function scaryClown() {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
            resolve(&#39;ğŸ¤¡&#39;);
        }, 2000);
    });
}

async function msg() {
    const msg = await scaryClown();
    console.log(`Message: ${msg}`); // Message:ğŸ¤¡ &lt;-- after 2 seconds
}</code></pre>
<blockquote>
<p>await æ˜¯ ES8 ä¸­æ–°å¢çš„æ“ä½œç¬¦ï¼Œç”¨æ¥ç­‰å¾…ä¸€ä¸ª promise å®Œæˆ(resolve)æˆ–è¢«æ‹’ç»(reject).å®ƒåªèƒ½åœ¨ async å‡½æ•°å†…ä½¿ç”¨ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ async å‡½æ•°çš„ä¼˜åŠ¿åœ¨è¿›è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œçš„æ—¶å€™ä½“ç°çš„æ›´ä¸ºæ˜æ˜¾ã€‚</p>
<pre><code class="javascript">function who() {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
            resolve(&#39;ğŸ¤¡&#39;);
        }, 200);
    });
}

function what() {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
            resolve(&#39;lurks&#39;);
        }, 300);
    });
}

function where() {
    return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
            resolve(&#39;in the shadow&#39;);
        }, 500);
    });
}

async function msg() {
    const a = await who();
    const b = await what();
    const c = await where();

    console.log(`${a} ${b} ${c}`);
}
msg(); // ğŸ¤¡ lurks in the shadow &lt;-- after 1 second</code></pre>
<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ä»£ç ä¸­ aï¼Œbï¼Œc ä¸‰ä¸ªå˜é‡çš„èµ‹å€¼æ“ä½œæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªç”Ÿæˆ promise çš„æ–¹æ³•è¦ç­‰åˆ°ä¸Šä¸€ä¸ª å·²ç»ç”Ÿæˆçš„ promise å®Œæˆæˆ–è¢«æ‹’ç»åæ‰å¼€å§‹æ‰§è¡Œã€‚å¦‚ï¼šwho()è¿”å›çš„ promise åœ¨ 200ms å resolvedï¼Œåˆ™ what å°±éœ€è¦åœ¨ 200ms ä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚å¦‚æœéœ€è¦å°†è¿™äº› promise åŒæ—¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ Primise.all æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰çš„ promise å®Œæˆã€‚</p>
<pre><code class="javascript">async function msg() {
    const [a, b, c] = Promise.all([who(), what(), where()]);
    console.log(`${a} ${b} ${c}`);
}
msg(); // ğŸ¤¡ lurks in the shadow &lt;-- after 500ms</code></pre>
<p>ä¸€æ—¦ä¼ å…¥çš„æ‰€æœ‰ promise éƒ½å®Œæˆäº†ï¼ŒPromise.all å°±ä¼šè¿”å›ä¸€ä¸ªç”±æ‰€æœ‰ resolved values ç»„æˆçš„æ•°ç»„ã€‚</p>
<h2 id="è¿”å›-Promise"><a href="#è¿”å›-Promise" class="headerlink" title="è¿”å› Promise"></a>è¿”å› Promise</h2><p>Async å‡½æ•°æ€»ä¼šè¿”å›ä¸€ä¸ª promiseï¼Œå› æ­¤ä¸‹é¢çš„ä»£ç å¹¶ä¸ä¼šäº§ç”Ÿç±»ä¼¼æ™®é€šå‡½æ•°æ‰€é¢„æœŸçš„ç»“æœï¼š</p>
<pre><code class="javascript">async function hello() {
    return &#39;Hello Alligator&#39;;
}
const b = hello();
console.log(b); // Promise {...}</code></pre>
<p>åŸºäº async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œä½ å¯ä»¥è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>
<pre><code class="javascript">async function hello() {
    return &#39;Hello Alligator!&#39;;
}

// ç­‰åŒäºhello().then(x =&gt; console.log(x));
const b = hello();
b.then((x) =&gt; console.log(x)); // Hello Alligator!</code></pre>
<h2 id="åˆ›å»º-async-çš„ä¸åŒå½¢å¼"><a href="#åˆ›å»º-async-çš„ä¸åŒå½¢å¼" class="headerlink" title="åˆ›å»º async çš„ä¸åŒå½¢å¼"></a>åˆ›å»º async çš„ä¸åŒå½¢å¼</h2><p>ç›®å‰åœ¨ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªç”¨å‡½æ•°å£°æ˜çš„æ–¹å¼åˆ›å»ºäº† async å‡½æ•°ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å‡½æ•°è¡¨è¾¾å¼å’Œç®­å¤´å‡½æ•°æ¥åˆ›å»º async å‡½æ•°ã€‚</p>
<h3 id="async-å‡½æ•°è¡¨è¾¾å¼"><a href="#async-å‡½æ•°è¡¨è¾¾å¼" class="headerlink" title="async å‡½æ•°è¡¨è¾¾å¼"></a>async å‡½æ•°è¡¨è¾¾å¼</h3><pre><code class="javascript">const msg = async function () {
    const msg = await scaryClown();
    console.log(`Message: ${msg}`);
};</code></pre>
<h3 id="async-ç®­å¤´å‡½æ•°"><a href="#async-ç®­å¤´å‡½æ•°" class="headerlink" title="async ç®­å¤´å‡½æ•°"></a>async ç®­å¤´å‡½æ•°</h3><pre><code class="javascript">const msg = async () =&gt; {
    const msg = await scaryClown();
    console.log(`Message: ${msg}`);
};</code></pre>
<h2 id="é”™è¯¯æ•æ‰"><a href="#é”™è¯¯æ•æ‰" class="headerlink" title="é”™è¯¯æ•æ‰"></a>é”™è¯¯æ•æ‰</h2><p>async å‡½æ•°å¦ä¸€ä¸ªå¯¹å¼€å‘è€…å‹å¥½çš„åœ°æ–¹åœ¨äºï¼Œå®ƒå¯ä»¥é€šè¿‡ tryâ€¦catch è¯­å¥ä»¥åŒæ­¥çš„æ–¹å¼è¿›è¡Œé”™è¯¯æ•æ‰å’Œå¤„ç†ã€‚ä¸‹é¢çš„ä¾‹å­ç”¨ä¸€ä¸ª rejected promise å±•ç¤ºäº† async å‡½æ•°çš„é”™è¯¯å¤„ç†ï¼š</p>
<pre><code class="javascript">function yayOrNay() {
    return new Promise((resolve, reject) =&gt; {
        const val = Math.round(Math.random() * 1); // 0 or 1, at random
        val ? resolve(&#39;Lucky!!&#39;) : reject(&#39;Nope ğŸ˜ &#39;);
    });
}

async function msg() {
    try {
        const msg = await yayOrNay();
        console.log(msg);
    } catch (err) {
        console.log(err);
    }
}

msg(); // Lucky!!
msg(); // Lucky!!
msg(); // Lucky!!
msg(); // Nope ğŸ˜ 
msg(); // Lucky!!
msg(); // Nope ğŸ˜ 
msg(); // Nope ğŸ˜ 
msg(); // Nope ğŸ˜ </code></pre>
<p>å› ä¸º async å‡½æ•°æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ª promiseï¼Œæ‰€ä»¥ä½ åŒæ ·å£å¯ä»¥ä½¿ç”¨ promise çš„ catch æ–¹æ³•è¿›è¡Œé”™è¯¯æ•æ‰ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="javascript">async function msg() {
    const msg = await yayOrNay();
    console.log(msg);
}
msg().catch((x) =&gt; console.log(x));</code></pre>
<h2 id="async-å‡½æ•°æ­é…-Promise-å¼-API"><a href="#async-å‡½æ•°æ­é…-Promise-å¼-API" class="headerlink" title="async å‡½æ•°æ­é… Promise å¼ API"></a>async å‡½æ•°æ­é… Promise å¼ API</h2><p>ä½¿ç”¨åŸç”Ÿçš„ Promise å¼ API ä¸ async å‡½æ•°ç»„åˆå¯ä»¥æ–¹ä¾¿çš„å†™å‡ºå¼‚æ­¥æ“ä½œï¼Œå¦‚ï¼š</p>
<pre><code class="javascript">async function fetchUsers(endpoint) {
    const res = await fetch(endpoint);
    let data = await res.json();

    data = data.map((user) =&gt; user.username);
    console.log(data);
}

fetchUsers(&#39;https://jsonplaceholder.typicode.com/users&#39;);
// [&quot;Bret&quot;, &quot;Antonette&quot;, ... &quot;Moriah.Stanton&quot;]</code></pre>
<blockquote>
<p>Fetch æ˜¯æ–°å¢çš„ web APIï¼Œå®ƒä»¥ Promise çš„å·¥ä½œæ–¹å¼è¿›è¡Œå¼‚æ­¥è¯·æ±‚ï¼Œä»è€Œé¿å…äº†ä½¿ç”¨ XMLHttpRequest æ‰€å¸¦æ¥çš„è®¸å¤šå†—ä½™ä»£ç ã€‚</p>
</blockquote>
<blockquote>
<p>åŸæ–‡ï¼š<a href="https://alligator.io/js/async-functions/" target="_blank" rel="noopener">https://alligator.io/js/async-functions/</a></p>
</blockquote>

          </div>
      </article>

      <div class="post-navigation">
        
        
        <div class="post-next">
            <a href="/2018/08/16/EventLoop%E6%9C%BA%E5%88%B6%E8%A7%A3%E6%9E%90/">
                <span class="post-next-title">Event Loopæœºåˆ¶è§£æ</span>
                <i class="iconfont icon-round-arrow-right"></i>
            </a>
        </div>
        
      </div>
  </div>

  <div id="disqus_thread"></div>

  <script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
  this.page.url = "http://www.qiwenke.com/2019/03/16/ES8%E4%B8%AD%E7%9A%84Async-Await%E5%87%BD%E6%95%B0/";  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = "http://www.qiwenke.com/2019/03/16/ES8%E4%B8%AD%E7%9A%84Async-Await%E5%87%BD%E6%95%B0/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://qiwenke.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>

</div>
<div class="post-catalog"></div>


<script src="/js/script.js"></script>


<script src="/js/prism.js"></script>
</body>
</html>